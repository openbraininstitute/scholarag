
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../deployment/">
      
      
        <link rel="next" href="../reference/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.47">
    
    
      
        <title>Scripts - Scholarag</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#scripts" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Scholarag" class="md-header__button md-logo" aria-label="Scholarag" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Scholarag
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Scripts
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../concepts/" class="md-tabs__link">
        
  
    
  
  Basic concepts

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../examples/" class="md-tabs__link">
        
  
    
  
  Examples

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../endpoints/" class="md-tabs__link">
        
  
    
  
  Endpoints

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../setup/" class="md-tabs__link">
        
  
    
  
  Application Setup

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../deployment/" class="md-tabs__link">
        
  
    
  
  Application Deployment

      </a>
    </li>
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
    
  
  Scripts

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../reference/" class="md-tabs__link">
        
  
    
  
  Reference

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Scholarag" class="md-nav__button md-logo" aria-label="Scholarag" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Scholarag
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basic concepts
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Examples
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../endpoints/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Endpoints
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Application Setup
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../deployment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Application Deployment
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Scripts
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Scripts
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create_impact_factor_indexpy" class="md-nav__link">
    <span class="md-ellipsis">
      create_impact_factor_index.py
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manage_indexpy" class="md-nav__link">
    <span class="md-ellipsis">
      manage_index.py
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parse_and_uploadpy" class="md-nav__link">
    <span class="md-ellipsis">
      parse_and_upload.py
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pmc_parse_and_uploadpy" class="md-nav__link">
    <span class="md-ellipsis">
      pmc_parse_and_upload.py
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pu_producerpy-pu_consumerpy" class="md-nav__link">
    <span class="md-ellipsis">
      pu_producer.py + pu_consumer.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pu_producer.py + pu_consumer.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pu_producerpy" class="md-nav__link">
    <span class="md-ellipsis">
      pu_producer.py
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pu_consumerpy" class="md-nav__link">
    <span class="md-ellipsis">
      pu_consumer.py
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reference
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create_impact_factor_indexpy" class="md-nav__link">
    <span class="md-ellipsis">
      create_impact_factor_index.py
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manage_indexpy" class="md-nav__link">
    <span class="md-ellipsis">
      manage_index.py
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parse_and_uploadpy" class="md-nav__link">
    <span class="md-ellipsis">
      parse_and_upload.py
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pmc_parse_and_uploadpy" class="md-nav__link">
    <span class="md-ellipsis">
      pmc_parse_and_upload.py
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pu_producerpy-pu_consumerpy" class="md-nav__link">
    <span class="md-ellipsis">
      pu_producer.py + pu_consumer.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pu_producer.py + pu_consumer.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pu_producerpy" class="md-nav__link">
    <span class="md-ellipsis">
      pu_producer.py
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pu_consumerpy" class="md-nav__link">
    <span class="md-ellipsis">
      pu_consumer.py
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="scripts">Scripts</h1>
<p>Scholarag comes shipped with several handy scripts that help with filling up a database with documents used in the main API. They allow the user to parse and upload articles from several sources, while pre-defining the various fields in the DB that should contain article's metadata. Combined with the parsers offered in <code>bbs-etl</code>, they offer an easy solution to have a production grade database based on several data sources. There exist five main scripts:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>create_impact_factor_index.py
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>manage_index.py
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>parse_and_upload.py
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>pmc_parse_and_upload.py
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>pu_producer.py<span class="w"> </span>+<span class="w"> </span>pu_consumer.py
</span></code></pre></div>
<h2 id="create_impact_factor_indexpy">create_impact_factor_index.py</h2>
<p>This script is creating the index containing impact factors of scientific journals. 
Data to populate the index should be saved under an excel file with the same schema as 
the one that can be found under <code>tests/data/citescore_sample.xlsx</code>.
This file can be asked to https://www.elsevier.com/products/scopus/metrics/citescore. </p>
<p>Once the file is obtained, one can simply run the script by specifying the path to the file,
the name of the index one wants to have and the database where to save it.</p>
<p>After creating this index, one can use it in the application by specifying the environment
variable <code>SCHOLARAG__DB__INDEX_JOURNALS</code> with the new index name. Impact factors of the journals
are going to be given to the user when returning articles metadata.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>positional<span class="w"> </span>arguments:
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span>from_file<span class="w">             </span>Path<span class="w"> </span>to<span class="w"> </span>file<span class="w"> </span>containing<span class="w"> </span>impact<span class="w"> </span>factor<span class="w"> </span>information.
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">  </span>index<span class="w">                 </span>Name<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>index<span class="w"> </span>to<span class="w"> </span>create.
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">  </span>db_url<span class="w">                </span>URL<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>database<span class="w"> </span>instance.<span class="w"> </span>Format:<span class="w"> </span>HOST:PORT
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>options:
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">  </span>-h,<span class="w"> </span>--help<span class="w">            </span>show<span class="w"> </span>this<span class="w"> </span><span class="nb">help</span><span class="w"> </span>message<span class="w"> </span>and<span class="w"> </span><span class="nb">exit</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">  </span>--db-type<span class="w"> </span><span class="o">{</span>elasticsearch,opensearch<span class="o">}</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">                        </span>Type<span class="w"> </span>of<span class="w"> </span>database.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>opensearch<span class="o">)</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">  </span>--user<span class="w"> </span>USER<span class="w">           </span>User<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>database<span class="w"> </span>instance.<span class="w"> </span>The<span class="w"> </span>password<span class="w"> </span>is<span class="w"> </span><span class="nb">read</span><span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>environment<span class="w"> </span>under<span class="w"> </span>SCHOLARAG__DB__PASSWORD.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>None<span class="o">)</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">  </span>-v,<span class="w"> </span>--verbose<span class="w">         </span>Control<span class="w"> </span>verbosity<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>False<span class="o">)</span>
</span></code></pre></div>
<h2 id="manage_indexpy">manage_index.py</h2>
<p>This script is a very simple database setup script. It allows for three concrete actions on a specific index: <code>create</code>, <code>delete</code>, <code>reset</code>.</p>
<ul>
<li>
<p><strong>create</strong>: Create the specified index with a mapping compatible with what the main API expects, ready to receive documents from the parsers on <code>bbs-etl</code>. Several options can be provided to customise the index, but always within the usecase of the main API.</p>
</li>
<li>
<p><strong>delete</strong>: Simply delete the specified index if it exists.</p>
</li>
<li>
<p><strong>reset</strong>: Apply first delete, then create. It is a handy way to erase everything in your index for experimentation.</p>
</li>
</ul>
<p>The remaining arguments of the script are typical arguments to point to the db, connect to it, and have a small customization capability. Here is an exhaustive list:</p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>positional<span class="w"> </span>arguments:
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">  </span><span class="o">{</span>create,delete,reset<span class="o">}</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">                        </span>Specify<span class="w"> </span>the<span class="w"> </span>action<span class="w"> </span>to<span class="w"> </span>take.<span class="w"> </span><span class="nv">Reset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>delete<span class="w"> </span>-&gt;<span class="w"> </span>create.
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">  </span>index<span class="w">                 </span>Name<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>index<span class="w"> </span>to<span class="w"> </span>deal<span class="w"> </span>with.
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">  </span>db_url<span class="w">                </span>URL<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>database<span class="w"> </span>instance.<span class="w"> </span>Format:<span class="w"> </span>HOST:PORT
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>options:
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">  </span>-h,<span class="w"> </span>--help<span class="w">            </span>show<span class="w"> </span>this<span class="w"> </span><span class="nb">help</span><span class="w"> </span>message<span class="w"> </span>and<span class="w"> </span><span class="nb">exit</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">  </span>--db-type<span class="w"> </span><span class="o">{</span>elasticsearch,opensearch<span class="o">}</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">                        </span>Type<span class="w"> </span>of<span class="w"> </span>database.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>elasticsearch<span class="o">)</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">  </span>--user<span class="w"> </span>USER<span class="w">           </span>User<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>database<span class="w"> </span>instance.<span class="w"> </span>The<span class="w"> </span>password<span class="w"> </span>is<span class="w"> </span><span class="nb">read</span><span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>environment<span class="w"> </span>under<span class="w"> </span>SCHOLARAG__DB__PASSWORD.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>None<span class="o">)</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">  </span>--embed-name<span class="w"> </span>EMBED_NAME
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">                        </span>Name<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>embedding<span class="w"> </span>field.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>embed_multi-qa-mpnet-base-dot-v1:1_0_0<span class="o">)</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">  </span>--embed-dims<span class="w"> </span>EMBED_DIMS
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">                        </span>Dimension<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>embedding<span class="w"> </span>vectors.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span><span class="m">768</span><span class="o">)</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">  </span>--n-shards<span class="w"> </span>N_SHARDS<span class="w">   </span>Number<span class="w"> </span>of<span class="w"> </span>shards<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>index.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">  </span>--n-replicas<span class="w"> </span>N_REPLICAS
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="w">                        </span>Number<span class="w"> </span>of<span class="w"> </span>replicas<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>index.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span><span class="m">1</span><span class="o">)</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="w">  </span>-v,<span class="w"> </span>--verbose<span class="w">         </span>Control<span class="w"> </span>verbosity<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>False<span class="o">)</span>
</span></code></pre></div>
The password of the database, if it exists, should be set in the environment under the variable name <code>SCHOLARAG__DB__PASSWORD</code>.</p>
<h2 id="parse_and_uploadpy">parse_and_upload.py</h2>
<p>This script parses local files (on your computer) and uploads them to the database you point to. It leverages the parsers in <code>bbs-etl</code> to extract the information from your xml/pdf files as well as the mapping provided by <code>manage_index.py</code>. Make sure to create an index using the latter before running this script. Here is an exhaustive list of the script's arguments:</p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>positional<span class="w"> </span>arguments:
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span>path<span class="w">                  </span>File<span class="w"> </span>or<span class="w"> </span>directory<span class="w"> </span>where<span class="w"> </span>are<span class="w"> </span>located<span class="w"> </span>the<span class="w"> </span>articles<span class="w"> </span>to<span class="w"> </span>parse.
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">  </span>parser_url<span class="w">            </span>URL<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>parser<span class="w"> </span><span class="o">(</span>needs<span class="w"> </span>to<span class="w"> </span>contain<span class="w"> </span>this<span class="w"> </span>address<span class="w"> </span>and<span class="w"> </span>the<span class="w"> </span>parser<span class="o">)</span>.
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">  </span>db_url<span class="w">                </span>URL<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>database<span class="w"> </span>instance<span class="w"> </span><span class="o">(</span>together<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>port<span class="o">)</span>.
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>options:
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">  </span>-h,<span class="w"> </span>--help<span class="w">            </span>show<span class="w"> </span>this<span class="w"> </span><span class="nb">help</span><span class="w"> </span>message<span class="w"> </span>and<span class="w"> </span><span class="nb">exit</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">  </span>--articles-per-bulk<span class="w"> </span>ARTICLES_PER_BULK
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">                        </span>Maximum<span class="w"> </span>number<span class="w"> </span>of<span class="w"> </span>articles<span class="w"> </span>to<span class="w"> </span>process<span class="w"> </span>before<span class="w"> </span>sending<span class="w"> </span>them<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>db.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span><span class="m">1000</span><span class="o">)</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">  </span>--multipart-params<span class="w"> </span>MULTIPART_PARAMS
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">                        </span>Dictionary<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>multipart<span class="w"> </span>parameters<span class="w"> </span><span class="k">for</span><span class="w"> </span>parsers<span class="w"> </span>that<span class="w"> </span>require<span class="w"> </span>some.<span class="w"> </span>Must<span class="w"> </span>be<span class="w"> </span>passed<span class="w"> </span>as<span class="w"> </span>a<span class="w"> </span>json<span class="w"> </span>formated<span class="w"> </span>dict.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>None<span class="o">)</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">  </span>--max-concurrent-requests<span class="w"> </span>MAX_CONCURRENT_REQUESTS
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">                        </span>Maximum<span class="w"> </span>number<span class="w"> </span>of<span class="w"> </span>articles<span class="w"> </span>sent<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>etl<span class="w"> </span>server<span class="w"> </span>PER<span class="w"> </span>BATCH<span class="w"> </span>OF<span class="w"> </span><span class="s1">&#39;articles-per-bulk&#39;</span><span class="w"> </span>articles.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span><span class="m">10</span><span class="o">)</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">  </span>--db-type<span class="w"> </span><span class="o">{</span>elasticsearch,opensearch<span class="o">}</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">                        </span>Type<span class="w"> </span>of<span class="w"> </span>database.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>opensearch<span class="o">)</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="w">  </span>--user<span class="w"> </span>USER<span class="w">           </span>User<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>database<span class="w"> </span>instance.<span class="w"> </span>The<span class="w"> </span>password<span class="w"> </span>is<span class="w"> </span><span class="nb">read</span><span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>environment<span class="w"> </span>under<span class="w"> </span>SCHOLARAG__DB__PASSWORD.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>None<span class="o">)</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="w">  </span>--index<span class="w"> </span>INDEX<span class="w">         </span>Desired<span class="w"> </span>name<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>index<span class="w"> </span>holding<span class="w"> </span>paragraphs.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>paragraphs<span class="o">)</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="w">  </span>--files-failing-path<span class="w"> </span>FILES_FAILING_PATH
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="w">                        </span>Path<span class="w"> </span>where<span class="w"> </span>to<span class="w"> </span>dump<span class="w"> </span>the<span class="w"> </span>files<span class="w"> </span>that<span class="w"> </span>failed.<span class="w"> </span>Expects<span class="w"> </span>a<span class="w"> </span>file.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>None<span class="o">)</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="w">  </span>-m<span class="w"> </span>MATCH_FILENAME,<span class="w"> </span>--match-filename<span class="w"> </span>MATCH_FILENAME
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="w">                        </span>Parse<span class="w"> </span>only<span class="w"> </span>files<span class="w"> </span>with<span class="w"> </span>a<span class="w"> </span>name<span class="w"> </span>matching<span class="w"> </span>the<span class="w"> </span>given<span class="w"> </span>regular<span class="w"> </span>expression.<span class="w"> </span>Ignored<span class="w"> </span>when<span class="w"> </span><span class="s1">&#39;input_path&#39;</span><span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>path<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>file.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>None<span class="o">)</span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="w">  </span>-r,<span class="w"> </span>--recursive<span class="w">       </span>Parse<span class="w"> </span>files<span class="w"> </span>recursively.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>False<span class="o">)</span>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a><span class="w">  </span>--use-ssl<span class="w">             </span>Whether<span class="w"> </span>to<span class="w"> </span>verify<span class="w"> </span>ssl<span class="w"> </span>certificates<span class="w"> </span>or<span class="w"> </span>not.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>False<span class="o">)</span>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a><span class="w">  </span>-v,<span class="w"> </span>--verbose<span class="w">         </span>Control<span class="w"> </span>verbosity<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>False<span class="o">)</span>
</span></code></pre></div>
The parser specified under <code>parser_url</code> MUST contain the endpoint, which means that one must carefully select the correct parser for their data. For instance, xmls originating from PMC should use the <code>jats_xml</code> parser. Xmls originating from scopus must use the <code>xocs_xml</code> parser. Pdfs should use the <code>grobid_pdf</code> parser and so on. Please refer to the <code>bbs-etl</code> documentation for more information.</p>
<h2 id="pmc_parse_and_uploadpy">pmc_parse_and_upload.py</h2>
<p>This script is very similar to <code>parse_and_upload.py</code>, except that it doesn't use local files but rather fetches the files located in the public AWS s3 bucket of PMC. This bucket contains an up to date dump of the entirety of PMC (representing at this time roughly 6M articles). It uses <code>boto3</code> and <code>aiobotocore</code> to fetch and download files from the s3 bucket, and doesn't require any specific permission or access. It is a great way to download rapidly a big volume of data for experimentation.  It leverages the parsers in <code>bbs-etl</code> to extract the information from the xmls as well as the mapping provided by <code>manage_index.py</code>. Make sure to create an index using the latter before running this script. Here is an exhaustive list of the script's arguments:</p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>positional<span class="w"> </span>arguments:
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span>db_url<span class="w">                </span>URL<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>database<span class="w"> </span>instance<span class="w"> </span><span class="o">(</span>together<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>port<span class="o">)</span>.
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">  </span>parser_url<span class="w">            </span>URL<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>parser<span class="w"> </span><span class="o">(</span>needs<span class="w"> </span>to<span class="w"> </span>contain<span class="w"> </span>the<span class="w"> </span>host:port<span class="w"> </span>and<span class="w"> </span>the<span class="w"> </span>parser<span class="w"> </span><span class="nb">type</span><span class="o">)</span>.
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>options:
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">  </span>-h,<span class="w"> </span>--help<span class="w">            </span>show<span class="w"> </span>this<span class="w"> </span><span class="nb">help</span><span class="w"> </span>message<span class="w"> </span>and<span class="w"> </span><span class="nb">exit</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">  </span>--start-date<span class="w"> </span>START_DATE
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">                        </span>Date<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>oldest<span class="w"> </span>document<span class="w"> </span>to<span class="w"> </span>download.<span class="w"> </span>Format:<span class="w"> </span>dd-mm-yyy.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>None<span class="o">)</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">  </span>--batch-size<span class="w"> </span>BATCH_SIZE
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">                        </span>Maximum<span class="w"> </span>number<span class="w"> </span>of<span class="w"> </span>articles<span class="w"> </span>to<span class="w"> </span>process<span class="w"> </span>before<span class="w"> </span>sending<span class="w"> </span>them<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>db.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span><span class="m">500</span><span class="o">)</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">  </span>--multipart-params<span class="w"> </span>MULTIPART_PARAMS
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">                        </span>Dictionary<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>multipart<span class="w"> </span>parameters<span class="w"> </span><span class="k">for</span><span class="w"> </span>parsers<span class="w"> </span>that<span class="w"> </span>require<span class="w"> </span>some.<span class="w"> </span>Must<span class="w"> </span>be<span class="w"> </span>passed<span class="w"> </span>as<span class="w"> </span>a<span class="w"> </span>json<span class="w"> </span>formated<span class="w"> </span>dict.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>None<span class="o">)</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">  </span>--max-concurrent-requests<span class="w"> </span>MAX_CONCURRENT_REQUESTS
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">                        </span>Maximum<span class="w"> </span>number<span class="w"> </span>of<span class="w"> </span>articles<span class="w"> </span>sent<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>etl<span class="w"> </span>server<span class="w"> </span>PER<span class="w"> </span>BATCH<span class="w"> </span>OF<span class="w"> </span><span class="s1">&#39;articles-per-bulk&#39;</span><span class="w"> </span>articles.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span><span class="m">10</span><span class="o">)</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">  </span>--db-type<span class="w"> </span><span class="o">{</span>elasticsearch,opensearch<span class="o">}</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">                        </span>Type<span class="w"> </span>of<span class="w"> </span>database.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>opensearch<span class="o">)</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">  </span>--user<span class="w"> </span>USER<span class="w">           </span>User<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>database<span class="w"> </span>instance.<span class="w"> </span>The<span class="w"> </span>password<span class="w"> </span>is<span class="w"> </span><span class="nb">read</span><span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>environment<span class="w"> </span>under<span class="w"> </span>SCHOLARAG__DB__PASSWORD.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>None<span class="o">)</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">  </span>--index<span class="w"> </span>INDEX<span class="w">         </span>Desired<span class="w"> </span>name<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>index<span class="w"> </span>holding<span class="w"> </span>paragraphs.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>pmc_paragraphs<span class="o">)</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="w">  </span>--files-failing-path<span class="w"> </span>FILES_FAILING_PATH
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">                        </span>Path<span class="w"> </span>where<span class="w"> </span>to<span class="w"> </span>dump<span class="w"> </span>the<span class="w"> </span>files<span class="w"> </span>that<span class="w"> </span>failed.<span class="w"> </span>Expects<span class="w"> </span>a<span class="w"> </span>file.<span class="w"> </span>Not<span class="w"> </span>dumping<span class="w"> </span><span class="k">if</span><span class="w"> </span>None.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>None<span class="o">)</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">  </span>--use-ssl<span class="w">             </span>Whether<span class="w"> </span>to<span class="w"> </span>verify<span class="w"> </span>ssl<span class="w"> </span>certificates<span class="w"> </span>or<span class="w"> </span>not.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>False<span class="o">)</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="w">  </span>-v,<span class="w"> </span>--verbose<span class="w">         </span>Control<span class="w"> </span>verbosity<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>False<span class="o">)</span>
</span></code></pre></div>
The correct parser endpoint to use for this script is <code>jats_xml</code> since every file originates from PMC. If <code>--start-date</code> remains <code>None</code>, it will be set to the previous day so that if you run this script automatically every day, you would always fetch the latest updates.</p>
<h2 id="pu_producerpy-pu_consumerpy">pu_producer.py + pu_consumer.py</h2>
<p>These scripts should be used together. They leverage an AWS service called SQS quich provides a queue service. They are the most efficient way to efficiently populate a production database with a huge amount of files.</p>
<h3 id="pu_producerpy">pu_producer.py</h3>
<p>When it comes to using a queue service, the producer has the role of putting messages in the queue for the consumer to consume them. Here, the producer fetches articles in a specific AWS s3 bucket, gets the relevant article path, and forwards this information into the queue. It also includes a bunch of metadata into the message, so that the consumer knows what to do. Here is an exhaustive list of the script's arguments:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>positional<span class="w"> </span>arguments:
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">  </span>bucket_name<span class="w">           </span>Url<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>provider<span class="w"> </span>where<span class="w"> </span>to<span class="w"> </span>download<span class="w"> </span>the<span class="w"> </span>articles.
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">  </span>queue_url<span class="w">             </span>Url<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>queue<span class="w"> </span>where<span class="w"> </span>to<span class="w"> </span>upload<span class="w"> </span>the<span class="w"> </span>articles.
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>options:
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">  </span>-h,<span class="w"> </span>--help<span class="w">            </span>show<span class="w"> </span>this<span class="w"> </span><span class="nb">help</span><span class="w"> </span>message<span class="w"> </span>and<span class="w"> </span><span class="nb">exit</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">  </span>--index<span class="w"> </span>INDEX<span class="w">         </span>Desired<span class="w"> </span>name<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>index<span class="w"> </span>holding<span class="w"> </span>paragraphs.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>pmc_paragraphs<span class="o">)</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">  </span>--parser-name<span class="w"> </span>PARSER_NAME
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">                        </span>Endpoint<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>parser<span class="w"> </span>to<span class="w"> </span>use.<span class="w"> </span>Specify<span class="w"> </span>only<span class="w"> </span><span class="k">if</span><span class="w"> </span>the<span class="w"> </span>s3<span class="w"> </span>bucket<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>ours.<span class="w"> </span>Else<span class="w"> </span>it<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>fetch<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>path.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>None<span class="o">)</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">  </span>--start-date<span class="w"> </span>START_DATE
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">                        </span>Date<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>oldest<span class="w"> </span>document<span class="w"> </span>to<span class="w"> </span>download.<span class="w"> </span>Format:<span class="w"> </span>dd-mm-yyy.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>None<span class="o">)</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">  </span>--prefixes<span class="w"> </span>PREFIXES<span class="w"> </span><span class="o">[</span>PREFIXES<span class="w"> </span>...<span class="o">]</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">                        </span>Prefix<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>s3<span class="w"> </span>path<span class="w"> </span>to<span class="w"> </span>filter<span class="w"> </span>the<span class="w"> </span>search<span class="w"> </span>on.<span class="w"> </span>Can<span class="w"> </span>write<span class="w"> </span>multiple<span class="w"> </span>prefixes<span class="w"> </span>to<span class="w"> </span>make<span class="w"> </span>it<span class="w"> </span>a<span class="w"> </span>list.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>None<span class="o">)</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">  </span>--sign-request<span class="w">        </span>Sign<span class="w"> </span>the<span class="w"> </span>request<span class="w"> </span>with<span class="w"> </span>AWS<span class="w"> </span>credential.<span class="w"> </span>Should<span class="w"> </span>be<span class="w"> </span>activated<span class="w"> </span><span class="k">for</span><span class="w"> </span>our<span class="w"> </span>bucket,<span class="w"> </span>not<span class="w"> </span><span class="k">for</span><span class="w"> </span>public<span class="w"> </span>external<span class="w"> </span>buckets.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>False<span class="o">)</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">  </span>--file-extension<span class="w"> </span>FILE_EXTENSION
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w">                        </span>Extension<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>file<span class="w"> </span>to<span class="w"> </span>enqueue.<span class="w"> </span>Leave<span class="w"> </span>None<span class="w"> </span>to<span class="w"> </span>parse<span class="w"> </span>any<span class="w"> </span>file<span class="w"> </span>type.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>None<span class="o">)</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">  </span>-v,<span class="w"> </span>--verbose<span class="w">         </span>Control<span class="w"> </span>verbosity<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>False<span class="o">)</span>
</span></code></pre></div>
<p>This script can work with any s3 bucket in theory. However if you point to a private s3 bucket, you need to sign your request with your AWS credentials using <code>--sign-request</code>. The <code>--prefixes</code> argument can be a list of partial paths inside of the s3 bucket, which will restrict the bucket crawling to the specified values. Finally <code>--file-extension</code> can be used to partially match the name of the files of interest, for instance by specifying only a certain type of files.
The <code>--parser-name</code> is of very specific interest. If you point this script towards an external s3 bucket (for instance the PMC one), it is likely that every file will need to be parsed with the same parser (e.g. <code>jats_xml</code> for the PMC bucket). However, to remain compatible with any data provider, even those not having an s3 bucket, we offer the possibility to infer the type of parser from the name of the folder containing the data. For instance assume that you have the five following parsers: <code>jats_xml</code>, <code>xocs_xml</code>, <code>grobid_pdf</code>, <code>pubmed_xml</code> and <code>core_json</code>. Assume that you have a private s3 bucket with the following layout:
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>my-s3-bucket
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a> core_json
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    file1.json
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>    file2.json
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a> jats_xml
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>    file1.xml
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>    file2.xml
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a> grobid_pdf
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>    file1.pdf
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>    file2.pdf
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a> xocs_xml
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>    file1.xml
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>    file2.xml
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a> pubmed_xml
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>    file1.xml
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>    file2.xml
</span></code></pre></div>
If you run the script without providing <code>--parser-name</code> and pointing to this s3 bucket, each file will be sent to the queue alongside with the name of its parent folder as the parser to use for parsing. Therefore, one can download locally any file (compatible with the parsers) from any provider, and simply dump them in the s3 bucket under the correct folder for parsing.</p>
<h3 id="pu_consumerpy">pu_consumer.py</h3>
<p>The consumer script is complementary to the producer one. As soon as one runs the producer scripts, messages (articles) will be put in the sqs queue. The role of the consumer is to retrieve these messages, parse them and upload them to your database (that has a compatible index created using the <code>manage_index.py</code> script). Here is an exhaustive list of the script's arguments:</p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>positional<span class="w"> </span>arguments:
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">  </span>db_url<span class="w">                </span>URL<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>database<span class="w"> </span>instance<span class="w"> </span><span class="o">(</span>together<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>port<span class="o">)</span>.
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">  </span>parser_url<span class="w">            </span>URL<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>parser<span class="w"> </span><span class="o">(</span>needs<span class="w"> </span>to<span class="w"> </span>contain<span class="w"> </span>the<span class="w"> </span>host:port<span class="o">)</span>.
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">  </span>queue_url<span class="w">             </span>Url<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>queue<span class="w"> </span>where<span class="w"> </span>to<span class="w"> </span>upload<span class="w"> </span>the<span class="w"> </span>articles.
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>options:
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">  </span>-h,<span class="w"> </span>--help<span class="w">            </span>show<span class="w"> </span>this<span class="w"> </span><span class="nb">help</span><span class="w"> </span>message<span class="w"> </span>and<span class="w"> </span><span class="nb">exit</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">  </span>--batch-size<span class="w"> </span>BATCH_SIZE,<span class="w"> </span>-b<span class="w"> </span>BATCH_SIZE
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">                        </span>Maximum<span class="w"> </span>number<span class="w"> </span>of<span class="w"> </span>articles<span class="w"> </span>to<span class="w"> </span>process<span class="w"> </span>before<span class="w"> </span>sending<span class="w"> </span>them<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>db.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span><span class="m">500</span><span class="o">)</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">  </span>--max-concurrent-requests<span class="w"> </span>MAX_CONCURRENT_REQUESTS
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">                        </span>Maximum<span class="w"> </span>number<span class="w"> </span>of<span class="w"> </span>articles<span class="w"> </span>sent<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>etl<span class="w"> </span>server<span class="w"> </span>PER<span class="w"> </span>BATCH<span class="w"> </span>OF<span class="w"> </span><span class="s1">&#39;articles-per-bulk&#39;</span><span class="w"> </span>articles.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span><span class="m">10</span><span class="o">)</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">  </span>--db-type<span class="w"> </span><span class="o">{</span>elasticsearch,opensearch<span class="o">}</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">                        </span>Type<span class="w"> </span>of<span class="w"> </span>database.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>opensearch<span class="o">)</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="w">  </span>--user<span class="w"> </span>USER<span class="w">           </span>User<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>database<span class="w"> </span>instance.<span class="w"> </span>The<span class="w"> </span>password<span class="w"> </span>is<span class="w"> </span><span class="nb">read</span><span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>environment<span class="w"> </span>under<span class="w"> </span>SCHOLARAG__DB__PASSWORD.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>None<span class="o">)</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="w">  </span>--use-ssl<span class="w">             </span>Whether<span class="w"> </span>to<span class="w"> </span>verify<span class="w"> </span>ssl<span class="w"> </span>certificates<span class="w"> </span>or<span class="w"> </span>not.<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>False<span class="o">)</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="w">  </span>-v,<span class="w"> </span>--verbose<span class="w">         </span>Control<span class="w"> </span>verbosity<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>False<span class="o">)</span>
</span></code></pre></div>
Here the <code>parser_url</code> MUST NOT contain the endpoint, since the endpoint is passed alongside with the message and is then retrieved individually for each message. The consumer script is a simple script that runs forever, doing what we call "long polling" of the queue. It will continuously listen to the queue, and process messages as soon as some are encountered in the queue. It implements multiprocessing capabilities to parallelize the processing of multiple messages at once. Typically useful to deploy it on a server and let it run continuously.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.instant.progress", "navigation.sections", "navigation.path", "navigation.top", "toc.follow", "search.suggest", "search.highlight", "pymdownx.superfences", {"pymdownx.tabbed": {"alternate_style": true}}], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>